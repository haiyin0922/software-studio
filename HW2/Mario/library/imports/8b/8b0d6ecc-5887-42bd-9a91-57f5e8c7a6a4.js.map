{"version":3,"sources":["..\\..\\..\\..\\assets\\Scripts/assets\\Scripts\\Player.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\assets\\Scripts","sourcesContent":["import GameMgr from \"./GameMgr\";\r\nimport Board from \"./Board\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class Player extends cc.Component {\r\n\r\n    @property(Board)\r\n    board: Board = null;\r\n\r\n    @property()\r\n    playerSpeed: number = 250;\r\n\r\n    @property({type:cc.AudioClip})\r\n    jumpSound: cc.AudioClip = null;\r\n\r\n    @property({type:cc.AudioClip})\r\n    dieSound: cc.AudioClip = null;\r\n\r\n    @property({type:cc.AudioClip})\r\n    bigSound: cc.AudioClip = null;\r\n\r\n    @property({type:cc.AudioClip})\r\n    smallSound: cc.AudioClip = null;\r\n\r\n    @property({type:cc.AudioClip})\r\n    eatSound: cc.AudioClip = null;\r\n\r\n\r\n    private onGround: boolean = false;\r\n    private anim: cc.Animation = null;\r\n    private action = \"idle\";\r\n    private moveDir = 0;\r\n    private mode = 0;   //0:small, 1:big, 2:die\r\n    private super = false;\r\n\r\n    start () {\r\n        this.anim = this.getComponent(cc.Animation);\r\n    }\r\n\r\n    update (dt) {\r\n        if(this.mode < 2){\r\n            if(cc.find(\"Canvas/Main Camera/Board/timer/val\").getComponent(cc.Label).string == '0'){\r\n                this.playerDie();\r\n            }\r\n            else{\r\n                switch(this.moveDir)\r\n                {\r\n                    case 1:\r\n                        this.node.x += this.playerSpeed * this.moveDir * dt;\r\n                    case 2:\r\n                        this.node.scaleX = 2.5;\r\n                        break;\r\n                    case -1: \r\n                        this.node.x += this.playerSpeed * this.moveDir * dt;\r\n                    case -2:\r\n                        this.node.scaleX = -2.5;\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n        this.node.scaleY = 2.5;\r\n        this.playerAnimation();\r\n    }\r\n\r\n    playerAnimation() {\r\n        if(this.mode == 0) {\r\n            if(!this.anim.getAnimationState(\"small_walk\").isPlaying && this.action==\"walk\" && this.onGround){\r\n                this.anim.play(\"small_walk\");\r\n            }\r\n            else if(!this.anim.getAnimationState(\"small_jump\").isPlaying && this.action==\"jump\" && !this.onGround){\r\n                this.anim.play(\"small_jump\");\r\n            }\r\n            else if(this.action==\"idle\" && this.onGround){\r\n                this.anim.play(\"small_idle\");\r\n            }\r\n        }\r\n        else if(this.mode == 1) {\r\n            if(!this.anim.getAnimationState(\"big_walk\").isPlaying && this.action==\"walk\" && this.onGround){\r\n                this.anim.play(\"big_walk\");\r\n            }\r\n            else if(!this.anim.getAnimationState(\"big_jump\").isPlaying && this.action==\"jump\" && !this.onGround){\r\n                this.anim.play(\"big_jump\");\r\n            }\r\n            else if(this.action==\"idle\" && this.onGround){\r\n                this.anim.play(\"big_idle\");\r\n            }\r\n        }\r\n        else {\r\n            if(!this.anim.getAnimationState(\"player_die\").isPlaying){\r\n                this.anim.play(\"player_die\");\r\n            }\r\n        }\r\n    }\r\n\r\n    touchGround() {\r\n        this.onGround = true;\r\n    }\r\n    noTouchGround() {\r\n        this.onGround = false;\r\n    }\r\n\r\n    changeMode(mode: number) {\r\n        //cc.log(\"super:\" + this.super);\r\n        if(mode == 0 && this.mode == 1) {\r\n            cc.audioEngine.playEffect(this.smallSound, false);\r\n            this.playerSuper();\r\n            this.mode = 0;\r\n            this.getComponent(cc.PhysicsBoxCollider).destroy();\r\n            let collider = this.addComponent(cc.PhysicsBoxCollider);\r\n            collider.size.width = 16;\r\n            collider.size.height = 16;\r\n        }\r\n        else if(mode == 1 && this.mode == 0) {\r\n            cc.audioEngine.playEffect(this.bigSound, false);\r\n            this.mode = 1;\r\n            this.getComponent(cc.PhysicsBoxCollider).destroy();\r\n            let collider = this.addComponent(cc.PhysicsBoxCollider);\r\n            collider.size.width = 15;\r\n            collider.size.height = 27;\r\n        }\r\n        else if(mode == 0 && this.mode == 0) {\r\n            this.playerDie();\r\n        }\r\n        else if(mode == 1 && this.mode == 1){\r\n            cc.audioEngine.playEffect(this.eatSound, false);\r\n        }\r\n    }\r\n\r\n    playerDie() {\r\n        cc.audioEngine.stopAll();\r\n        cc.audioEngine.playEffect(this.dieSound, false);\r\n        this.mode = 2;\r\n        this.getComponent(cc.PhysicsBoxCollider).enabled = false;\r\n        this.getComponent(cc.RigidBody).linearVelocity = cc.v2(0, 750);\r\n\r\n        firebase.auth().onAuthStateChanged((user) => {\r\n            var cleanEmail = user.email.replace(/\\./g, ',');\r\n            firebase.database().ref(cleanEmail).once('value', (snapshot) => {\r\n                var childData = snapshot.val();\r\n                firebase.database().ref(cleanEmail).set({\r\n                    life: childData.life-1,\r\n                    coin: childData.coin,\r\n                    score: childData.score\r\n                });\r\n                if(childData.life-1 > 0){\r\n                    if(cc.find(\"Canvas/Main Camera/Board/world/val\").getComponent(cc.Label).string == '1'){\r\n                        this.schedule(function(){\r\n                            cc.director.loadScene(\"start_easy\");\r\n                        }, 2);\r\n                    }\r\n                    else{\r\n                        this.schedule(function(){\r\n                            cc.director.loadScene(\"start_normal\");\r\n                        }, 2);\r\n                    }\r\n                }\r\n                else {\r\n                    firebase.auth().onAuthStateChanged(function(user) {\r\n                        var cleanEmail = user.email.replace(/\\./g, ',');\r\n                        firebase.database().ref(cleanEmail).once('value', function(snapshot) {\r\n                            firebase.database().ref(cleanEmail).set({\r\n                                score: 0,\r\n                                coin: 0,\r\n                                life: 5\r\n                            });\r\n                        });\r\n                    });\r\n                    this.schedule(function(){\r\n                        cc.director.loadScene(\"gameover\");\r\n                    }, 2);\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n    playerJump() {\r\n        if(this.onGround) {\r\n            cc.audioEngine.playEffect(this.jumpSound, false);\r\n            this.onGround = false;\r\n            this.getComponent(cc.RigidBody).linearVelocity = cc.v2(0, 750);\r\n        }\r\n    }\r\n\r\n    enemyJump() {\r\n        this.onGround = false;\r\n        this.getComponent(cc.RigidBody).linearVelocity = cc.v2(0, 750);\r\n    }\r\n\r\n    playerAction(action: string) {\r\n        this.action = action;\r\n    }\r\n\r\n    playerMove(moveDir: number) {\r\n        this.moveDir = moveDir;\r\n    }\r\n\r\n    playerSuper() {\r\n        this.super = true;\r\n        this.schedule(function(){\r\n               this.super = false;\r\n        }, 1);\r\n    }\r\n\r\n    getSuper() {\r\n        return this.super;\r\n    }\r\n\r\n    onBeginContact(contact, self, other) {\r\n        if(other.node.name == \"lowBound\"){\r\n            this.playerDie();\r\n        }\r\n    }\r\n}\r\n"]}