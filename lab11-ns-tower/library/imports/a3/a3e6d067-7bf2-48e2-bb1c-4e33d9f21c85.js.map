{"version":3,"sources":["..\\..\\..\\..\\assets\\Scripts/assets\\Scripts\\Platform.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\assets\\Scripts","sourcesContent":["const { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class Platform extends cc.Component {\r\n\r\n    protected isTouched: boolean = false;\r\n\r\n    private anim: cc.Animation = null;\r\n\r\n    private moveSpeed: number = 50;\r\n\r\n    private camera: cc.Node = null;\r\n\r\n    start() {\r\n        this.anim = this.getComponent(cc.Animation);\r\n\r\n        this.camera = cc.find('Canvas/Main Camera');\r\n\r\n        if (this.node.name == \"Conveyor\") {\r\n            this.node.scaleX = (Math.random() >= 0.5) ? 1 : -1;\r\n            this.moveSpeed *= this.node.scaleX;\r\n        }\r\n        else if(this.node.name == \"Normal\")\r\n        {\r\n            let canMove = (Math.random() > 0.8) ? true : false;\r\n            if(canMove)\r\n            {\r\n                let moveDir = (Math.random() > 0.5) ? \"v\" : \"h\";\r\n                let delayTime = Math.random() * 2;\r\n                this.platformMove(moveDir, delayTime);\r\n            }\r\n        }\r\n    }\r\n\r\n    update(dt)\r\n    {   \r\n        if(this.camera.y - this.node.y >= 190) // platform out of screen\r\n            this.platformDestroy();\r\n    }\r\n\r\n    playAnim() {\r\n        if(this.anim)\r\n            this.anim.play();\r\n    }\r\n\r\n    platformDestroy()\r\n    {\r\n        this.node.destroy();\r\n    }\r\n\r\n    platformMove(moveDir: string, delayTime: number)\r\n    {\r\n        let easeRate: number = 2;\r\n        // ===================== TODO =====================\r\n        // 1. Make platform move back and forth. You should use moveDir to decide move direction.\r\n        //    'v' for vertical, and 'h' for horizontal.\r\n        // 2. Use action system to make platfrom move forever.\r\n        //    For horizontal case, you should first move right 50 pixel in 2s and then move back to initial position in 2s\r\n        //    For vertical case, you should first move up 50 pixel in 2s and then move back to initial position in 2s\r\n        //    You need to use \"easeInOut\" to modify your action with \"easeRate\" as parameter.\r\n        // ================================================\r\n        this.scheduleOnce(function() {\r\n            if(moveDir == \"h\"){\r\n                let go = cc.moveBy(2, 50, 0).easing(cc.easeInOut(easeRate));\r\n                let back = cc.moveBy(2, -50, 0).easing(cc.easeInOut(easeRate));\r\n                go.easing(cc.easeInOut(easeRate));\r\n                back.easing(cc.easeInOut(easeRate));\r\n                this.node.runAction(cc.sequence(go, back)).repeatForever();\r\n            }\r\n            else if(moveDir == \"v\"){\r\n                let go = cc.moveBy(2, 0, 50).easing(cc.easeInOut(easeRate));\r\n                let back = cc.moveBy(2, 0, -50).easing(cc.easeInOut(easeRate));\r\n                go.easing(cc.easeInOut(easeRate));\r\n                back.easing(cc.easeInOut(easeRate));\r\n                this.node.runAction(cc.sequence(go, back)).repeatForever();\r\n            }\r\n        }, delayTime);\r\n    }\r\n\r\n  // ===================== TODO =====================\r\n  // 1. In the physics lecture, we know that Cocos Creator\r\n  //    provides four contact callbacks. You need to use callbacks to\r\n  //    design different behaviors for different platforms.\r\n  //\r\n  //    Hints: The callbacks are \"onBeginContact\", \"onEndContact\", \"onPreSolve\", \"onPostSolve\".\r\n  //\r\n  // 2. There are two different types of platforms: \"Normal\" & Conveyor\".\r\n  //    For \"Conveyor\", you have to do \"delivery effect\" when player is in contact with it.\r\n  //    Note that the platforms have \"delivery effect\" only when player stands on them. \r\n  //\r\n  //    Hints: Change \"linearVelocity\" of the player's rigidbody to make him move.\r\n  //    The move value is \"moveSpeed\".\r\n  //\r\n  // 3. All the platforms have only \"upside\" collision. You have to prevent the collisions from the other directions.\r\n  //\r\n  //    Hints: You can use \"contact.getWorldManifold().normal\" to judge collision direction.\r\n  //\r\n  // ================================================\r\n    onBeginContact(contact, self, other) {\r\n        if(contact.getWorldManifold().normal.y != 1 && other.node.name == \"player\"){\r\n            contact.disabled = true;\r\n            cc.log(\"!\");\r\n        }\r\n    }\r\n\r\n    onPreSolve(contact, self, other){\r\n        if(contact.getWorldManifold().normal.y != 1 && other.node.name == \"player\"){\r\n            contact.disabled = true;\r\n            cc.log(\"!\");\r\n        }\r\n    }\r\n\r\n    onPostSolve(contact, self, other){\r\n        if(contact.getWorldManifold().normal.y != 1 && other.node.name == \"player\"){\r\n            contact.disabled = true;\r\n            cc.log(\"!\");\r\n        }\r\n        var player_V = cc.v2(other.getComponent(cc.RigidBody).linearVelocity);\r\n        if(contact.getWorldManifold().normal.y == 1 && self.node.name == \"Conveyor\" && other.node.name == \"player\"){\r\n            other.getComponent(cc.RigidBody).linearVelocity = cc.v2(this.moveSpeed, player_V.y);\r\n        }\r\n    }\r\n\r\n    onEndContact(contact, self, other){\r\n        var player_V = cc.v2(other.getComponent(cc.RigidBody).linearVelocity);\r\n        if(contact.getWorldManifold().normal.y == 1 && self.node.name == \"Conveyor\" && other.node.name == \"player\"){\r\n            other.getComponent(cc.RigidBody).linearVelocity = cc.v2(0, player_V.y);\r\n        }\r\n        if(self.node.name == \"Conveyor\" && other.node.name == \"player\"){\r\n            other.getComponent(cc.RigidBody).linearVelocity = cc.v2(0, 0);\r\n        }\r\n    }\r\n}\r\n"]}