{"version":3,"sources":["bird.js"],"names":["cc","Class","extends","Component","properties","anchor1","default","type","Node","anchor2","draggable","attachRope","initPos","startPos","motorJoint","MotorJoint","ropeJoint","RopeJoint","rb","RigidBody","maxLength","initResetButton","clickEventHandler","EventHandler","target","node","component","handler","find","getComponent","Button","clickEvents","push","onLoad","director","getPhysicsManager","enabled","start","initProperties","update","diff","sub","position","angle","Math","atan2","x","y","mag","angularVelocity","setPosition","add","v2","misc","radiansToDegrees","rotate","reset","linearVelocity","Vec2","ZERO","gravityScale","onEnable","on","EventType","TOUCH_START","_onTouchBegan","TOUCH_MOVE","_onTouchMove","TOUCH_END","_onTouchEnded","TOUCH_CANCEL","_onTouchCancel","onDisable","off","event","enabledInHierarchy","stopPropagation","getStartLocation","cur","getLocation","subSelf","cur_v","normalizeSelf","mulSelf","dragEnd"],"mappings":"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","file":"bird.js","sourceRoot":"..\\..\\..\\..\\assets\\Scripts","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        anchor1: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        anchor2: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        draggable: {\r\n            default: true\r\n            // type: boolean\r\n        },\r\n        attachRope: {\r\n            default: true\r\n            // type: boolean\r\n        },\r\n        initPos: {\r\n            default: null\r\n            // type: cc.Vec2\r\n        },\r\n        startPos: {\r\n            default: null\r\n            // type: cc.Vec2\r\n        },\r\n        motorJoint: {\r\n            default: null,\r\n            type: cc.MotorJoint\r\n        },\r\n        ropeJoint: {\r\n            default: null,\r\n            type: cc.RopeJoint\r\n        },\r\n        rb: {\r\n            default: null,\r\n            type: cc.RigidBody\r\n        },\r\n        maxLength: {\r\n            default: null\r\n            // type: number\r\n        }\r\n    },\r\n\r\n    initResetButton () {\r\n        let clickEventHandler = new cc.Component.EventHandler();\r\n        clickEventHandler.target = this.node;\r\n        clickEventHandler.component = \"bird\";\r\n        clickEventHandler.handler = \"reset\";\r\n        \r\n        cc.find(\"Canvas/Reset\").getComponent(cc.Button).clickEvents.push(clickEventHandler);\r\n    },\r\n    \r\n    onLoad () {\r\n        cc.director.getPhysicsManager().enabled = true;\r\n    },\r\n\r\n    start () {\r\n        this.initProperties();\r\n        this.initResetButton();\r\n    },\r\n\r\n    update () {\r\n        var diff =  this.initPos.sub(this.node.position);\r\n        var angle = Math.atan2(diff.x, diff.y);\r\n        if (this.node.position.sub(this.initPos).mag() <= 10){\r\n            if(!this.draggable){\r\n                this.motorJoint.enabled = false;\r\n                this.ropeJoint.enabled = false;\r\n                this.rb.angularVelocity = -angle * 20;\r\n                this.attachRope = false;\r\n                this.anchor1.setPosition(this.initPos.add(cc.v2(-20, 0)));\r\n                this.anchor2.setPosition(this.initPos.add(cc.v2(-20, 0)));\r\n            }\r\n        } else {\r\n            if (this.attachRope) {\r\n                this.node.angle = - cc.misc.radiansToDegrees(angle) + 90;\r\n    \r\n                this.anchor1.setPosition(this.node.position.add(cc.v2(-18, 2).rotate(-angle+90)));\r\n                this.anchor2.setPosition(this.node.position.add(cc.v2(-18, 2).rotate(-angle+90)));\r\n            }\r\n        }\r\n    },\r\n\r\n    initProperties () {\r\n        this.anchor1 = cc.find(\"Canvas/Slingshot/SlingshotFront/anchor1\");\r\n        this.anchor1.setPosition(this.node.position.add(cc.v2(-20, 0)));\r\n        this.anchor2 = cc.find(\"Canvas/Slingshot/SlingshotBack/anchor2\");\r\n        this.anchor2.setPosition(this.node.position.add(cc.v2(-20, 0)));\r\n        \r\n        this.motorJoint = this.getComponent(cc.MotorJoint);\r\n        this.ropeJoint = this.getComponent(cc.RopeJoint);\r\n        this.rb = this.getComponent(cc.RigidBody);\r\n\r\n        this.initPos = this.node.position;\r\n        this.startPos = this.node.position;\r\n\r\n        this.maxLength = this.ropeJoint.maxLength;\r\n    },\r\n\r\n    reset () {\r\n        this.node.setPosition(this.initPos);\r\n\r\n        this.rb.linearVelocity = cc.Vec2.ZERO;\r\n        this.rb.angularVelocity = 0;\r\n        this.rb.gravityScale = 0;\r\n        \r\n        this.node.angle = 0;\r\n        this.draggable = true;\r\n        this.attachRope = true;\r\n    },\r\n\r\n    onEnable () {\r\n        this.node.on(cc.Node.EventType.TOUCH_START, this._onTouchBegan, this);\r\n        this.node.on(cc.Node.EventType.TOUCH_MOVE, this._onTouchMove, this);\r\n        this.node.on(cc.Node.EventType.TOUCH_END, this._onTouchEnded, this);\r\n        this.node.on(cc.Node.EventType.TOUCH_CANCEL, this._onTouchCancel, this);\r\n    },\r\n    \r\n    onDisable () {\r\n        this.node.off(cc.Node.EventType.TOUCH_START, this._onTouchBegan, this);\r\n        this.node.off(cc.Node.EventType.TOUCH_MOVE, this._onTouchMove, this);\r\n        this.node.off(cc.Node.EventType.TOUCH_END, this._onTouchEnded, this);\r\n        this.node.off(cc.Node.EventType.TOUCH_CANCEL, this._onTouchCancel, this);\r\n    },\r\n    \r\n    _onTouchBegan (event) {\r\n        if (!this.enabledInHierarchy) return;\r\n\r\n        if(this.draggable) {\r\n            this.startPos = this.node.position;\r\n            this.motorJoint.enabled = false;\r\n            this.rb.gravityScale = 0;\r\n            this.rb.linearVelocity = cc.Vec2.ZERO;\r\n            this.rb.angularVelocity = 0;\r\n        }\r\n        event.stopPropagation();\r\n    },\r\n    \r\n    _onTouchMove (event) {\r\n        if (!this.enabledInHierarchy) return;\r\n    \r\n        if(this.draggable){\r\n            let start = event.getStartLocation();\r\n            let cur = event.getLocation();\r\n            cur.subSelf(start);\r\n            \r\n            let cur_v = cc.v2(cur.x, cur.y);\r\n            if(cur_v.mag() > this.maxLength){\r\n                cur_v.normalizeSelf().mulSelf(this.maxLength);\r\n            }\r\n\r\n            this.node.setPosition(this.startPos.add(cur_v));\r\n            \r\n            this.rb.linearVelocity = cc.Vec2.ZERO;\r\n            this.rb.angularVelocity = 0;\r\n        }\r\n\r\n        event.stopPropagation();\r\n    },\r\n    \r\n    _onTouchEnded (event) {\r\n        if (!this.enabledInHierarchy) return;\r\n    \r\n        this.dragEnd();\r\n    \r\n        event.stopPropagation();\r\n    },\r\n    \r\n    _onTouchCancel (event) {\r\n        if (!this.enabledInHierarchy) return;\r\n\r\n        this.dragEnd();\r\n    \r\n        event.stopPropagation();\r\n    },\r\n\r\n    dragEnd () {\r\n        if (!this.draggable) return;\r\n\r\n        if (this.node.position.sub(this.startPos).mag() > 10){\r\n            this.draggable = false;\r\n        }\r\n\r\n        this.motorJoint.enabled = true;\r\n\r\n        this.rb.gravityScale = 1;\r\n        this.rb.linearVelocity = cc.v2(1, 0);\r\n    }\r\n});\r\n"]}